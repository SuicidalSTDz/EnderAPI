local function assert(bBool, sMessage, iLevel)
	local iLevel = iLevel or -1
	if type(sMessage) ~= "string" then
		error("String expected, got " .. type(sMessage), 2)
	elseif type(iLevel) ~= "number" then
		error("Number expected, got " .. type(iLevel), 2)
	end
	
	if not bBool then
		error( sMessage, iLevel + 1 )
	end
	return bBool
end

put = function( sFile )
  assert(type(sFile)=="string","string expected, got "..type(sFile), 2)
  
  local sPath = shell.resolve( sFile )
  if fs.isDir( sPath ) then
    error( "cannot upload directories", 2 )
  elseif not fs.exists( sPath ) then
    error( "no such file", 2 )
  end
  
  local sName = fs.getName( sPath )
  local handle = fs.open( sPath, "r" )
  local sText = handle.readAll()
  handle.close()
  local key = "0ec2eb25b6166c0c27a394ae118ad829"
  local response = http.post(
    "http://pastebin.com/api/api_post.php", 
    "api_option=paste&" ..
    "api_dev_key=" .. key .. "&" ..
    "api_paste_format=lua&" ..
    "api_paste_name=" .. textutils.urlEncode( sPath ) .. "&" ..
    "api_paste_code=" .. textutils.urlEncode( sText )
  )

  if response then
    local sResponse = response.readAll()
    local sCode = string.match( sResponse, "[^/]+$" )
    response.close()
    return sCode
  end
  return false
end

get = function( sCode, sFile )
  assert( type(sCode)=="string", "number expected, got " .. type(ny), 2)
  assert( type(sFile)=="string", "string expected, got " .. type(sFile), 2)
  
  local sPath = shell.resolve( sFile )
  assert( not fs.exists( sPath ), "File exists", 2 )

  local response = http.get( "http://pastebin.com/raw.php?i=" .. textutils.urlEncode( sCode ) )
  if response then
    local sResponse = response.readAll()
    response.close()
    
    local handle = fs.open( sPath, "w" )
    handle.write( sResponse )
    handle.close()
    
    return true
  end
  return false
end

updateFile = function( sCode, sFile )
  assert( type( sCode ) == "string", "String expected, got " .. type( sCode ), 2 )
  assert( type( sFile ) == "string", "String expected, got " .. type( sFile ), 2 )
  
  local sPath = shell.resolve( sFile )
  assert( fs.exists( sPath ), "Existing file expected", 2)
  
  local httpHandle = http.get( "http://pastebin.com/raw.php?i=" .. textutils.urlEncode( sCode ) )
  if httpHandle then
    local httpContent = httpHandle.readAll()
    httpHandle.close()
  
    local fileHandle = fs.open( sPath, "r" )
    local fileContent = fileHandle.readAll()
    fileHandle.close()
    
    if fileContent ~= httpContent then
      fs.delete( sPath )
      fileHandle = fs.open( sPath, "w" )
      fileHandle.write( httpContent )
      fileHandle.close()
      return true
    end
  end
  return false
 end
 